---
title: "Demo the Cut-Up Technique for Hymns"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Demo the Cut-Up Technique for Hymns}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(salmer)
```

## Introduction

Let's try to use the cut-up technique on the top popular hymn, *Se, nu stiger solen af havets skÃ¸d*, by Jacob Knudsen, 1891. This is number [754](link:https://www.dendanskesalmebogonline.dk/salme/754) in *Den Danske Salmebog*.

```{r}
hymns %>% 
  dplyr::filter(doc_id == 754) %>% 
  dplyr::select(doc_id, verse, text) 
```

## Cutting it up

Inspecting a few colums from the annotation dataframe, `annotated_hymns`, available in the package, we see that `cut_up()` adds a new column, `token_new` with a suggestion for a new token, with same number of vowels and same part-of-speach-tag (in column `upos`).

We can retain a (little) bit of sanity, by excepting punctuation from being cut up, so that an exclamation mark will stay that and not turn into a semicolon. (The `except` parameter accepts a character vector, so we can have more than one exception).

```{r}
cut754 <- salmer::annotated_hymns %>% cut_up(754, except = "PUNCT")

cut754 %>% dplyr::select(doc_id, token, upos, vowels, token_new)
```

## Collapsing back into readable text

In order to better be able to appreciate the beauty of the poetry, we would like to turn the one-token-per-row dataframe back in a one-line-per-row dataframe like in `hymns`. For that, we use the function `collapse_annotation()`.

For starters, we can check how the original text looks like, by collapsing using the `token` column:

```{r}
cut754 %>% salmer::collapse_annotation(token)
```

The cut-up-version, has suggested words in the `token_new` column. This version will read as follows:

```{r}
cut754 %>% salmer::collapse_annotation(token_new)
```

For better comparison, we can arrange the two versions side-by-side:

```{r}
dplyr::bind_cols(
  salmer::collapse_annotation(cut754, token), 
  salmer::collapse_annotation(cut754, token_new)
  ) %>% 
  dplyr::select(doc_id = doc_id...1, 
         paragraph_id = paragraph_id...2, 
         original = text...3, 
         cut_up_text = text...6)
```

